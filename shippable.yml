language: node_js

node_js:
  - 0.10.25

services:
   - mongodb

env:
  global:
    - APP_NAME=thawing-journey-6674
    - MONGOLAB_URI=mongodb://localhost/test
    - XUNIT_FILE=shippable/testresults/result.xml
    - secure: zrB21Wd1g2wAhwg8kC13NujnxEWSo9hZ/MmgoFYeM8PQ9rxb5f3rZkeceoNgY/fgSJ8Eh7FXkpJEq2zlJsypeGPZoyzXIFbqqEtiTP3uvSiq3nZErf99QmrBa6T2Esvb6AyW+122yhDXEV68oBVqbFKDb7Z4eIQtHO7MMkQzcdelUgLQLmTke7Eh/9okofAxsKdUhcoCBeRzkhqX7VyhcBEMfAU+ZM1dCForV/2GYhZitH2HsIhNqwXl6d4X2m/xMW3r2UC19wLTZsPUlNJ+WYfel9bavy2LpIcxoO5GpEcjY5ej6uO9F6d6cjUHR8jvQQe3Gf14UaLqH6cbG+bbWw==

before_install:
  - which heroku || wget -qO- https://toolbelt.heroku.com/install-ubuntu.sh | sh

before_script: 
  - mkdir -p shippable/testresults
  - mkdir -p shippable/codecoverage

after_success:
  - ./node_modules/.bin/istanbul cover grunt -- -u tdd
  - ./node_modules/.bin/istanbul report cobertura --dir  shippable/codecoverage/
  - test -f ~/.ssh/id_rsa.heroku || ssh-keygen -y -f ~/.ssh/id_rsa > ~/.ssh/id_rsa.heroku && heroku keys:add ~/.ssh/id_rsa.heroku
  - git remote -v | grep ^heroku || heroku git:remote --app $APP_NAME
  - git push -f heroku $BRANCH:master
